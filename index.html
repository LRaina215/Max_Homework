<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘å¿ƒä¸­çš„é©¬å…‹æ€ | 2024çº§æ™ºç§‘ä½œä¸š</title>
    
    <!-- å¼•å…¥æ ¸å¿ƒåº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        :root {
            --primary-red: #ff2a2a;
            --gold: #ffd700;
            --bg-color: #050505;
            --glass: rgba(20, 20, 20, 0.9);
        }

        body, html { margin: 0; padding: 0; overflow-x: hidden; background-color: var(--bg-color); color: #e0e0e0; font-family: 'Courier New', 'Segoe UI', sans-serif; }
        
        /* æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: var(--primary-red); border-radius: 4px; }

        /* === 1. å¯åŠ¨é¡µ (Start Screen) === */
        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background: #000; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 1s ease;
            text-align: center;
        }
        .start-btn {
            padding: 15px 40px; border: 2px solid var(--primary-red); color: var(--primary-red);
            background: transparent; font-size: 1.2rem; font-weight: bold; cursor: pointer;
            text-transform: uppercase; letter-spacing: 3px; transition: 0.3s; margin-top: 30px;
            animation: pulse 2s infinite;
        }
        .start-btn:hover { background: var(--primary-red); color: #fff; box-shadow: 0 0 30px var(--primary-red); }
        .music-credit { margin-top: 20px; font-size: 0.9rem; color: var(--gold); font-style: italic; opacity: 0.8; }
        @keyframes pulse { 0% {box-shadow: 0 0 0 0 rgba(255, 42, 42, 0.4);} 70% {box-shadow: 0 0 0 20px rgba(255, 42, 42, 0);} 100% {box-shadow: 0 0 0 0 rgba(255, 42, 42, 0);} }

        /* === 2. å¯¼èˆªæ  & ä¿®å¤æŒ‰é’® === */
        nav { position: fixed; top: 0; width: 100%; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); border-bottom: 1px solid rgba(255, 42, 42, 0.3); box-sizing: border-box; }
        .logo { font-weight: 900; font-size: 1.2rem; color: var(--primary-red); letter-spacing: 1px; }
        
        /* ä¿®å¤æŒ‰é’®æ ·å¼ */
        .fix-btn {
            background: rgba(255, 255, 255, 0.1); border: 1px solid #555; color: #aaa;
            padding: 5px 10px; font-size: 0.7rem; cursor: pointer; border-radius: 4px;
            transition: 0.3s;
        }
        .fix-btn:hover { border-color: var(--gold); color: var(--gold); }

        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: -1; }

        .content { position: relative; z-index: 10; width: 100%; max-width: 1200px; margin: 0 auto; opacity: 0; transition: opacity 1s; }

        /* Section é€šç”¨å¸ƒå±€ */
        .section { 
            min-height: 85vh; /* ä¿è¯é«˜åº¦ï¼Œåˆ©äºæ»šåŠ¨è®¡ç®— */
            padding: 80px 20px; 
            display: flex; flex-direction: column; justify-content: center; 
            position: relative; 
        }
        
        .hero { min-height: 100vh; justify-content: center; }
        
        h1 { font-size: clamp(3rem, 8vw, 6rem); margin: 0; line-height: 1; color: #fff; text-shadow: 0 0 20px rgba(255, 42, 42, 0.5); }
        h1 span { color: var(--primary-red); }
        
        .hero-desc { margin-top: 30px; font-size: 1.2rem; border-left: 4px solid var(--gold); padding-left: 15px; color: #fff; max-width: 700px; background: rgba(0,0,0,0.6); padding: 15px; border-radius: 0 10px 10px 0; }

        /* å¡ç‰‡æ ·å¼ */
        .theory-card { 
            background: var(--glass); 
            border: 1px solid rgba(255, 42, 42, 0.3); 
            padding: 30px; border-radius: 8px; position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-bottom: 20px;
        }
        .theory-card:hover { border-color: var(--gold); }
        .theory-card::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--primary-red); }
        .theory-card h2 { color: var(--gold); margin-top: 0; font-size: 1.8rem; }
        .theory-card p { line-height: 1.8; color: #ddd; font-size: 1.05rem; text-align: justify; }

        .highlight { color: var(--primary-red); font-weight: bold; background: rgba(255, 42, 42, 0.1); padding: 0 4px; }

        /* AI èŠå¤© */
        .chat-container {
            width: 100%; height: 500px; background: rgba(0, 0, 0, 0.85);
            border: 1px solid var(--primary-red); border-radius: 10px;
            display: flex; flex-direction: column; box-shadow: 0 0 50px rgba(255, 42, 42, 0.15); overflow: hidden;
        }
        .chat-header { padding: 15px 20px; background: rgba(255, 42, 42, 0.15); border-bottom: 1px solid var(--primary-red); display: flex; justify-content: space-between; align-items: center; }
        .status-dot { width: 10px; height: 10px; background: #00ff00; border-radius: 50%; box-shadow: 0 0 10px #00ff00; margin-right: 10px; display: inline-block; }
        .chat-window { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; }
        .message { max-width: 85%; padding: 15px; border-radius: 8px; line-height: 1.6; font-size: 0.95rem; }
        .message.user { align-self: flex-end; background: #333; color: #fff; border: 1px solid #555; }
        .message.ai { align-self: flex-start; background: rgba(60, 0, 0, 0.6); border: 1px solid var(--primary-red); color: #ffd1d1; }
        .chat-input-area { padding: 20px; background: #111; display: flex; gap: 10px; border-top: 1px solid #333; }
        input[type="text"] { flex: 1; background: #222; border: 1px solid #444; color: #fff; padding: 15px; border-radius: 4px; font-family: inherit; font-size: 1rem; }
        input[type="text"]:focus { outline: none; border-color: var(--primary-red); background: #000; }
        button { background: var(--primary-red); color: #fff; border: none; padding: 0 30px; cursor: pointer; font-weight: bold; border-radius: 4px; transition: 0.3s; font-size: 1rem; }

        /* éŸ³ä¹æŒ‰é’® */
        .music-control { position: fixed; bottom: 80px; right: 20px; z-index: 1001; cursor: pointer; opacity: 0.5; transition: 0.3s; }
        .music-control:hover { opacity: 1; transform: scale(1.1); }

        /* === åº•éƒ¨ Footer (æ–°å¢) === */
        footer {
            background: rgba(0,0,0,0.9); border-top: 1px solid #333;
            padding: 40px 20px; text-align: center; color: #666; font-size: 0.9rem;
            position: relative; z-index: 100; margin-top: 50px;
        }
        .footer-info { margin-bottom: 10px; }
        .team-names { color: var(--gold); font-weight: bold; margin-bottom: 10px; letter-spacing: 1px; }
        .course-info { font-size: 0.8rem; opacity: 0.7; }

    </style>
</head>
<body>

    <!-- ğŸµ èƒŒæ™¯éŸ³ä¹ï¼šè¯·ç¡®ä¿æ–‡ä»¶åä¸º music.mp3 -->
    <audio id="bgm" loop>
        <source src="music.mp3" type="audio/mpeg">
    </audio>

    <!-- 1. å¯åŠ¨å°é¢ -->
    <div id="start-screen">
        <h1 style="font-size: 2.5rem; margin-bottom: 10px;">RED PROJECT</h1>
        <div class="team-names" style="font-size: 1rem; margin-bottom: 30px;">
            Created by æ ¾ä¿Šè¾‰ Â· æ—å­è½© Â· é©¬æ¬£å®‡
        </div>
        
        <button class="start-btn" onclick="startExperience()">è¿›å…¥æ€æƒ³çŸ©é˜µ / ENTER</button>
        
        <!-- åŸåˆ›æ­Œæ›²æ ‡æ³¨ -->
        <div class="music-credit">
            ğŸµ èƒŒæ™¯éŸ³ä¹ï¼šã€Šç ´æ™“çš„é’Ÿå£°ã€‹ (åŸåˆ› / Original Composition)
        </div>
        <p style="margin-top: 10px; color: #444; font-size: 0.7rem;">ä½©æˆ´è€³æœºä½“éªŒæœ€ä½³</p>
    </div>

    <!-- éŸ³ä¹å¼€å…³ -->
    <div class="music-control" onclick="toggleMusic()" title="åˆ‡æ¢éŸ³ä¹">
        <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#ff2a2a" stroke-width="2">
            <path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle>
        </svg>
    </div>

    <!-- å¯¼èˆªæ  -->
    <nav>
        <div class="logo">RED_PROJECT // 1818-202X</div>
        <!-- ğŸ› ï¸ å¼ºåˆ¶æ˜¾ç¤ºæŒ‰é’®ï¼šè§£å†³å†…å®¹ä¸æ˜¾ç¤ºçš„ç»ˆææ‰‹æ®µ -->
        <button class="fix-btn" onclick="forceShowContent()" title="å¦‚æœæ»šåŠ¨çœ‹ä¸åˆ°å†…å®¹ï¼Œè¯·ç‚¹æ­¤æŒ‰é’®">
            âš ï¸ å†…å®¹æ²¡æ˜¾ç¤ºï¼Ÿç‚¹æˆ‘ä¿®å¤
        </button>
    </nav>

    <!-- 3D ç”»å¸ƒ -->
    <div id="canvas-container"></div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="content" id="main-content">
        
        <!-- Hero Section -->
        <div class="section hero">
            <h1>CYBER <br><span>MARX</span></h1>
            <div class="hero-desc">
                <p id="typewriter"></p>
            </div>
            <div style="margin-top: 50px; opacity: 0.6; font-size: 0.9rem;">â†“ å‘ä¸‹æ»šåŠ¨</div>
        </div>

        <!-- Section 1 -->
        <div class="section scroll-reveal">
            <div class="theory-card">
                <h2>01 / æ•°å­—å…¬æœ‰åˆ¶</h2>
                <h3>ä»ã€Šèµ„æœ¬è®ºã€‹åˆ° Open Source</h3>
                <p>
                    åœ¨å·¥ä¸šæ—¶ä»£ï¼Œé©¬å…‹æ€æ‰¹åˆ¤äº†<span class="highlight">ç”Ÿäº§èµ„æ–™çš„ç§æœ‰åˆ¶</span>ã€‚è€Œåœ¨ä»Šå¤©çš„æ•°å­—ä¸–ç•Œï¼Œä»£ç æˆä¸ºäº†æ–°çš„ç”Ÿäº§èµ„æ–™ã€‚
                    <br><br>
                    **å¼€æºè½¯ä»¶è¿åŠ¨ (Open Source)** æ˜¯ä¸€åœºæœªç»å®£æ‰¬çš„å…±äº§ä¸»ä¹‰å®è·µã€‚GitHub ä¸Šçš„å¼€æºä»“åº“ï¼Œå®é™…ä¸Šæ„å»ºäº†ä¸€ä¸ª<span class="highlight">æ•°å­—å…¬æœ‰åœ° (Digital Commons)</span>ï¼Œå®ƒæ‰“ç ´äº†çŸ¥è¯†äº§æƒå¯¹æŠ€æœ¯çš„å„æ–­ï¼Œè®©å…¨äººç±»å…±äº«æ™ºæ…§çš„ç»“æ™¶ã€‚
                </p>
            </div>
        </div>

        <!-- Section 2 -->
        <div class="section scroll-reveal">
            <div class="theory-card">
                <h2>02 / ç®—æ³•å¼‚åŒ–</h2>
                <h3>æ•°æ®æ‹œç‰©æ•™ (Data Fetishism)</h3>
                <p>
                    é©¬å…‹æ€æå‡ºäº†â€œäººçš„å¼‚åŒ–â€ï¼šå·¥äººåˆ›é€ äº†å•†å“ï¼Œå´è¢«å•†å“æ‰€å¥´å½¹ã€‚
                    <br><br>
                    åœ¨ç®—æ³•æ—¶ä»£ï¼Œè¿™ç§å¼‚åŒ–æ›´åŠ éšè”½ã€‚æˆ‘ä»¬é€šè¿‡ç‚¹å‡»å’Œæµè§ˆåˆ›é€ äº†æ•°æ®ï¼ˆæ•°å­—åŠ³åŠ¨ï¼‰ï¼Œä½†è¿™äº›æ•°æ®åè¿‡æ¥å˜æˆäº†æ¨èç®—æ³•ï¼ˆæ•°å­—èµ„æœ¬ï¼‰æ¥æ§åˆ¶æˆ‘ä»¬çš„å–œå¥½ã€‚
                    å½“æˆ‘ä»¬æ²‰è¿·äºçŸ­è§†é¢‘çš„ä¿¡æ¯èŒ§æˆ¿æ—¶ï¼Œæˆ‘ä»¬ä¸å†æ˜¯æŠ€æœ¯çš„ä¸»äººï¼Œè€Œæ˜¯<span class="highlight">æµé‡çš„å¥´éš¶</span>ã€‚
                </p>
            </div>
        </div>

        <!-- Section 3: AI Chat -->
        <div class="section scroll-reveal chat-section">
            <h2 style="margin-bottom: 30px; color: #fff; font-size: 2rem;">
                <span style="color:var(--primary-red)">//</span> è·¨æ—¶ç©ºè¿çº¿ï¼šAsk Marx
            </h2>
            <div class="chat-container">
                <div class="chat-header">
                    <div><span class="status-dot"></span><span style="font-weight: bold;">Karl_Marx_v1.0.exe</span></div>
                    <div style="font-size: 0.8rem; color: #aaa;">Online</div>
                </div>
                <div class="chat-window" id="chat-window">
                    <div class="message ai"><strong>é©¬å…‹æ€:</strong> åŒå¿—ä½ å¥½ã€‚æˆ‘åœ¨å†å²çš„è¿·é›¾ä¸­è§‚å¯Ÿç€ä½ ä»¬çš„æ—¶ä»£ã€‚æœ‰ä½•å›°æƒ‘ï¼Ÿ</div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="user-input" placeholder="è¾“å…¥é—®é¢˜..." autocomplete="off">
                    <button onclick="sendMessage()">å‘é€</button>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨ä¿¡æ¯ Footer -->
        <footer>
            <div class="team-names">Team: æ ¾ä¿Šè¾‰ / æ—å­è½© / é©¬æ¬£å®‡</div>
            <div class="course-info">Create For - é©¬å…‹æ€ä¸»ä¹‰åŸç†2024çº§æ™ºèƒ½ç§‘å­¦ä¸æŠ€æœ¯è¯¾ç¨‹ä½œä¸š</div>
            <div style="margin-top: 10px; font-size: 0.7rem;">Powered by WebGL & DeepSeek AI</div>
        </footer>

    </div>

    <script>
        // ============================================
        // 1. æ ¸å¿ƒä¿®å¤é€»è¾‘ï¼šå¼ºåˆ¶æ˜¾ç¤º + å¯åŠ¨æ§åˆ¶
        // ============================================
        
        // ğŸš¨ ç»ˆæä¿®å¤å‡½æ•°ï¼šå¦‚æœå†…å®¹æ²¡å‡ºæ¥ï¼Œç‚¹å³ä¸Šè§’æŒ‰é’®ï¼Œå¼ºåˆ¶æ¸…é™¤æ‰€æœ‰éšè—æ•ˆæœ
        function forceShowContent() {
            // 1. æ€æ‰æ‰€æœ‰æ­£åœ¨è¿›è¡Œçš„ GSAP åŠ¨ç”»ï¼Œé˜²æ­¢å¹²æ‰°
            ScrollTrigger.getAll().forEach(t => t.kill());
            
            // 2. å¼ºåˆ¶æŠŠæ‰€æœ‰å†…å®¹å—è®¾ä¸ºå¯è§
            const elements = document.querySelectorAll('.content, .section, .scroll-reveal, .theory-card');
            elements.forEach(el => {
                el.style.opacity = '1';
                el.style.transform = 'none';
                el.style.visibility = 'visible';
            });
            
            alert("å·²æ‰§è¡Œå¼ºåˆ¶ä¿®å¤ï¼šå†…å®¹åº”å·²å…¨éƒ¨æ˜¾ç¤ºã€‚");
        }

        function startExperience() {
            // æ’­æ”¾åŸåˆ›éŸ³ä¹
            const audio = document.getElementById('bgm');
            audio.volume = 0.5;
            audio.play().catch(e => console.log("éœ€äº¤äº’æ‰èƒ½æ’­æ”¾"));

            const startScreen = document.getElementById('start-screen');
            const content = document.getElementById('main-content');
            
            startScreen.style.opacity = '0';
            setTimeout(() => {
                startScreen.style.display = 'none';
                content.style.opacity = '1';
                
                // å…³é”®ï¼šé¡µé¢æ˜¾ç¤ºåï¼Œé‡æ–°è®¡ç®—æ»šåŠ¨ä½ç½®
                ScrollTrigger.refresh(); 
                typeWriter();
            }, 1000);
        }

        function toggleMusic() {
            const audio = document.getElementById('bgm');
            if(audio.paused) audio.play(); else audio.pause();
        }

        // ============================================
        // 2. Three.js èƒŒæ™¯
        // ============================================
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x050505, 0.02);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const geometry = new THREE.BufferGeometry();
        const count = 3500;
        const positions = new Float32Array(count * 3);
        const colors = new Float32Array(count * 3);
        for(let i=0; i<count*3; i++) {
            positions[i] = (Math.random()-0.5)*25; 
            colors[i] = Math.random()>0.5 ? 1 : 0.6; 
        }
        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
        const particles = new THREE.Points(geometry, new THREE.PointsMaterial({size:0.06, vertexColors:true, transparent:true, opacity:0.9, blending:THREE.AdditiveBlending}));
        scene.add(particles);
        camera.position.z = 5;

        let mouseX = 0, mouseY = 0;
        document.addEventListener('mousemove', (e) => {
            mouseX = (e.clientX - window.innerWidth/2) * 0.0005;
            mouseY = (e.clientY - window.innerHeight/2) * 0.0005;
        });
        function animate() {
            requestAnimationFrame(animate);
            particles.rotation.y += 0.001; 
            particles.rotation.y += (mouseX - particles.rotation.y) * 0.05;
            renderer.render(scene, camera);
        }
        animate();
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth/window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            ScrollTrigger.refresh();
        });

        // ============================================
        // 3. GSAP æ»šåŠ¨åŠ¨ç”»
        // ============================================
        gsap.registerPlugin(ScrollTrigger);

        window.addEventListener("load", () => { ScrollTrigger.refresh(); });

        gsap.utils.toArray('.scroll-reveal').forEach(elem => {
            gsap.from(elem, {
                y: 50, opacity: 0, duration: 1, ease: "power2.out",
                scrollTrigger: { 
                    trigger: elem, start: "top 85%", toggleActions: "play none none reverse" 
                }
            });
        });

        const text = "å“²å­¦å®¶ä»¬åªæ˜¯ç”¨ä¸åŒçš„æ–¹å¼è§£é‡Šä¸–ç•Œï¼Œé—®é¢˜åœ¨äºæ”¹å˜ä¸–ç•Œã€‚";
        let typeIdx = 0;
        function typeWriter() {
            if (typeIdx < text.length) {
                document.getElementById("typewriter").innerHTML += text.charAt(typeIdx);
                typeIdx++;
                setTimeout(typeWriter, 50);
            }
        }

        // ============================================
        // 4. AI å¯¹è¯
        // ============================================
        const API_KEY = ""; // å‰ç«¯ç•™ç©ºï¼Œä½¿ç”¨ Vercel åç«¯
        const API_URL = "/api/chat"; 

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const userText = input.value.trim();
            if (!userText) return;

            addMessage('user', userText);
            input.value = '';
            const loadingId = addMessage('ai', '<span style="opacity:0.7">æ€è€ƒä¸­...</span>');

            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [
                            {role: "system", content: "ä½ ç°åœ¨æ˜¯å¡å°”Â·é©¬å…‹æ€..."}, 
                            {role: "user", content: userText}
                        ]
                    })
                });

                if (!response.ok) throw new Error("API Error");
                const data = await response.json();
                updateMessage(loadingId, data.choices[0].message.content);

            } catch (error) {
                console.error(error);
                const backups = ["å†å²çš„è¾©è¯æ³•å‘Šè¯‰æˆ‘ä»¬ï¼ŒæŠ€æœ¯åº”å½“è§£æ”¾äººç±»ã€‚", "ä½ çš„å›°æƒ‘æºäºç”Ÿäº§å…³ç³»çš„ä¸åŒ¹é…ã€‚", "å…¨ä¸–ç•Œæ— äº§è€…ï¼Œè”åˆèµ·æ¥ï¼"];
                updateMessage(loadingId, backups[Math.floor(Math.random()*backups.length)] + " <br><span style='font-size:0.8rem;color:#888'>(ç¦»çº¿æ¨¡å¼)</span>");
            }
        }

        function addMessage(role, html) {
            const w = document.getElementById('chat-window');
            const d = document.createElement('div');
            d.className = `message ${role}`;
            d.id = 'msg-'+Date.now();
            d.innerHTML = role==='ai'?`<strong>é©¬å…‹æ€:</strong> ${html}`:html;
            w.appendChild(d);
            w.scrollTop = w.scrollHeight;
            return d.id;
        }
        function updateMessage(id, txt) {
            const d = document.getElementById(id);
            d.innerHTML = `<strong>é©¬å…‹æ€:</strong> ${window.marked ? marked.parseInline(txt) : txt}`;
        }
        document.getElementById('user-input').addEventListener('keypress', (e) => { if(e.key==='Enter') sendMessage(); });
    </script>
</body>
</html>